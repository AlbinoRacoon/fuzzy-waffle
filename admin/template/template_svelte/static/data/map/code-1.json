<script>
  import { onMount } from 'svelte';
  import { appVariables } from '../../stores/appVariables.js';
  import 'jsvectormap/dist/jsvectormap.min.css';
  
  let jsVectormap;
  let vectorMap;
  
  function renderMap(appVariables) {
    document.getElementById('vectorMapContainer').innerHTML = '<div id="vectorMap" style="height: 300px;"></div>';
    let markers = [
      { name: "Egypt", coords: [26.8206, 30.8025] },
      { name: "Russia", coords: [61.524, 105.3188] },
      { name: "Canada", coords: [56.1304, -106.3468] },
      { name: "Greenland", coords: [71.7069, -42.6043] },
      { name: "Brazil", coords: [-14.235, -51.9253] }
    ];
    vectorMap = new jsVectormap.default({
      selector: '#vectorMap',
      map: 'world',
      zoomButtons: true,
      normalizeFunction: 'polynomial',
      hoverOpacity: 0.5,
      hoverColor: false,
      zoomOnScroll: false,
      series: {
        regions: [{
          normalizeFunction: 'polynomial'
        }]
      },
      labels: {
        markers: {
          render: (marker) => marker.name
        }
      },
      focusOn: {
        x: 0.5,
        y: 0.5,
        scale: 1
      },
      markers: markers,
      markerStyle: {
        initial: {
          fill: appVariables.color.appTheme,
          stroke: 'none',
          r: 5,
        },
        hover: {
          fill: appVariables.color.appTheme
        }
      },
      markerLabelStyle: {
        initial: {
          fontFamily: appVariables.font.bodyFontFamily,
          fontSize: '12px',
          fill: 'rgba('+ appVariables.color.inverseRgb + ', .75)'
        },
      },
      regionStyle: {
        initial: {
          fill: appVariables.color.inverse,
          fillOpacity: 0.25,
          stroke: 'none',
          strokeWidth: 0.4,
          strokeOpacity: 1
        },
        hover: {
          fillOpacity: 0.5
        }
      },
      backgroundColor: 'transparent',
    });
  }
  
  onMount(async () => {
    jsVectormap = await import ('jsvectormap');
    await import ('jsvectormap/dist/maps/world.js');
    
    appVariables.subscribe(value => {
      if (value.color) {
        renderMap(value);
      }
    });
  });
</script>


<!-- html -->
<div id="vectorMapContainer" class="h-300px"></div>