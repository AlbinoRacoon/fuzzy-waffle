<script>
  import ApexCharts from '/src/components/plugins/ApexCharts.svelte';
  import { onMount } from 'svelte';
  import { appVariables } from '/src/stores/appVariables.js';
  
  let chartData = [];
  
  function getChartData(appVariables) {
    return {
      options: {
        chart: {
          type: 'line',
          height: 350,
          toolbar: { show: false }
        },
        series: [
          { name: 'High - 2024', data: [28, 29, 33, 36, 32, 32, 33] }, 
          { name: 'Low - 2024', data: [12, 11, 14, 18, 17, 13, 13] }
        ],
        title: {
          text: 'Average High & Low Temperature',
          align: 'center',
          color: appVariables.color.dark
        },
        colors: [appVariables.color.primary, appVariables.color.teal],
        dataLabels: {
          enabled: true,
          background: {
            enabled: true,
            foreColor: appVariables.color.white,
            padding: 4,
            borderRadius: 2,
            borderWidth: 0,
            borderColor: appVariables.color.dark,
            opacity: 0.9
          }
        },
        stroke: { curve: 'smooth', width: 3 },
        grid: {
          row: { colors: [appVariables.color.light, 'transparent'], opacity: 0.5 }
        },
        markers: { size: 4 },
        xaxis: { categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'] },
        yaxis: { min: 5, max: 40 },
        legend: {
          show: true,
          position: 'top',
          offsetY: -10,
          horizontalAlign: 'right',
          floating: true
        }
      }
    };
  }

  onMount(async () => {
    appVariables.subscribe(value => {
      if (value.color) {
        chartData = getChartData(value);
      }
    });
  });
</script>

{#if chartData}
  <ApexCharts options={chartData.options}></ApexCharts>
{/if}