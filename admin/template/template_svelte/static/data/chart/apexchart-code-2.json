<script>
  import ApexCharts from '/src/components/plugins/ApexCharts.svelte';
  import { onMount } from 'svelte';
  import { appVariables } from '/src/stores/appVariables.js';
  
  let chartData = [];
  
  function getChartData(appVariables) {
    return {
      options: {
        chart: { height: 350, type: 'bar' },
        series: [
          { name: 'Net Profit', data: [44, 55, 57, 56, 61, 58, 63, 60, 66] }, 
          { name: 'Revenue', data: [76, 85, 101, 98, 87, 105, 91, 114, 94] }, 
          { name: 'Free Cash Flow', data: [35, 41, 36, 26, 45, 48, 52, 53, 41] }
        ],
        title: {
          text: 'Profit & Margin Chart',
          align: 'center'
        },
        plotOptions: {
          bar: {
            horizontal: false,
            columnWidth: '55%',
            endingShape: 'rounded'  
          },
        },
        dataLabels: { enabled: false },
        stroke: {
          show: true,
          width: 2,
          colors: ['transparent']
        },
        colors: [appVariables.color.gray600, appVariables.color.indigo, appVariables.color.gray300],
        xaxis: { categories: ['Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'] },
        yaxis: {
          title: {
            text: '$ (thousands)',
            style: {
              color: appVariables.color.dark,
              fontSize: '12px',
              fontFamily: appVariables.font.family,
              fontWeight: 'bold'
            }
          }
        },
        fill: { opacity: 1 },
        tooltip: {
          y: {
            formatter: function (val) {
              return "$ " + val + " thousands"
            }
          }
        }
      }
    }
  }

  onMount(async () => {
    appVariables.subscribe(value => {
      if (value.color) {
        chartData = getChartData(value);
      }
    });
  });
</script>

{#if chartData}
  <ApexCharts options={chartData.options}></ApexCharts>
{/if}